<!-- TOC -->

- [文件事件处理器的构成](#文件事件处理器的构成)
- [I/O多路复用程序使用队列向事件分派器传送Socket事件](#io多路复用程序使用队列向事件分派器传送socket事件)

<!-- /TOC -->

由于Redis是纯内存操作的，所以数据的操作是非常快的，CPU不会基本不会成为Redis的瓶颈，这和传统的关系型数据库不通，传统的关系型数据库数据都是存储在磁盘的，由于磁盘的I/O是非常消耗时间的，所以为了提高数据库的性能一般都使用的是多线程技术。

而Redis和传统数据库相比，将数据存储在内存中，内存的执行效率是仅次于CPU的，效率不是问题。最有可能成为Redis的性能瓶颈的是网络消耗（当然，这也是传统数据库出现性能瓶颈的原因之一）。

所以Redis在设计时，就将其设计为单线程处理数据。这样不仅不会影响效率，还能减少开发的复杂性和后期维护的困难。和乐而不为。

但是需要注意的是，在单线程的设计下，Redis的处理数据的极限在8W~10W QPS，这对于绝大部分的企业来讲，完全足够使用，但是在互联网的快速发展下，开始出现越来越多的交易量上亿的场景，就需要要更大的QPS，所以Redis6.0中已经引入了多线程的处理机制，这里就不介绍了。

# 文件事件处理器的构成
Redis单线程模型，核心部分就是通过文件处理器模型来实现的。主要包含4个部分：Socket、I/O多路复用器、文件事件分发器、事件处理器(命令事件处理器、回复事件处理器、连接事件处理器)：   
![Redis的文件事件处理器模型](http://sunyanping.gitee.io/it-keep/ASSET/Redis的文件事件处理器模型.png)

文件事件处理器处理命令的过程：    
![文件事件处理器处理命令的过程](http://sunyanping.gitee.io/it-keep/ASSET/文件事件处理器处理命令的过程.png)

# I/O多路复用程序使用队列向事件分派器传送Socket事件
Redis是如何实现在多客户端并发下，单线程处理数据的，关键点就在 **队列** ，I/O多路复用程序在接收到不同客户端发送来的数据时，将这些Socket事件压入队列，然后按照顺序传送Socket事件给事件分派器，该Socket事件处理完成之后，才能处理下一个。这样就保证了任何时间都是单线程处理数据，也不用考虑并发带来的数据安全性。    
![IO多路复用程序使用队列向事件分配器传送Socket事件](http://sunyanping.gitee.io/it-keep/ASSET/IO多路复用程序使用队列向事件分配器传送Socket事件.jpg)

**参考文章：**    
- Redis的单线程模型：[https://blog.csdn.net/starcrm/article/details/106417503](https://blog.csdn.net/starcrm/article/details/106417503)
- 为什么Redis是单线程的：[https://zhuanlan.zhihu.com/p/87233515](https://zhuanlan.zhihu.com/p/87233515)
- Redis 6.0 新特性-多线程连环13问！[https://database.51cto.com/art/202005/616601.htm](https://database.51cto.com/art/202005/616601.htm)